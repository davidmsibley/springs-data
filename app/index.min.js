!(function(t){"function"==typeof define&&define.amd?define(t):t()})(function(){"use strict";const t=["#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c"],e=L.CircleMarker.extend({getEvents:function(){return{zoomend:this._restyle,normalpoints:this._normal,typepoints:this._orifice,condpoints:this._conductivity,qpoints:this._discharge}},_restyle:function(t){this.setRadius((t=>Math.max(t/1.5,3))(t.target.getZoom()))},_normal:function(t){this._activeBackup?this._activeBackup="#3388ff":this.setStyle({color:"#3388ff"})},_orifice:function(t){var e="#3388ff";"seepage/filtration"===this.feature.properties.Orifice_Geom&&(e="#33AA44"),this._activeBackup?this._activeBackup=e:this.setStyle({color:e})},_conductivity:function(e){for(var i=t[t.length-1],r=(aggrData.aggr.Conductivity_uS.max-aggrData.aggr.Conductivity_uS.min)/t.length,o=1;o<t.length;o++)if(r*o+aggrData.aggr.Conductivity_uS.min>this.feature.properties.Conductivity_uS){i=t[o];break}this._activeBackup?this._activeBackup=i:this.setStyle({color:i})},_discharge:function(e){for(var i=t[t.length-1],r=(aggrData.aggr.Discharge_cfs.max-aggrData.aggr.Discharge_cfs.min)/t.length,o=1;o<t.length;o++)if(r*o+aggrData.aggr.Discharge_cfs.min>this.feature.properties.Discharge_cfs){i=t[o];break}this._activeBackup?this._activeBackup=i:this.setStyle({color:i})},highlight:function(){this._activeBackup=this.options.color,this.setStyle({color:"orange"})},removeHighlight:function(){this._activeBackup&&(this.setStyle({color:this._activeBackup}),this._activeBackup=null)}});class i{constructor(t,e,r){this._springPhotos=e,this._springSketches=r,this._aggrKeys=["Site_Code","Conductivity_uS","Discharge_cfs","pH","Water_Temp_C"],this.aggrData=i._gatherAggrData(t,this._aggrKeys)}async lookupPhotos(t){const e=this._springPhotos;return new Promise(function(i,r){e.query().where("Site_Code = '"+t+"'").run(function(t,e){if(t)r(t);else{var o=e.features.map(function(t){return t.properties});o.sort(function(t,e){return t.Image_Number-e.Image_Number}),i(o)}})})}async lookupSketches(t){const e=this._springSketches;return new Promise(function(i,r){e.query().where("File_Prefix = '"+t+"'").run(function(t,e){if(t)r(t);else{var o=e.features.map(function(t,e){return t.properties.FileURL});i(o)}})})}static _gatherAggrData(t,e){const i={aggr:{},data:[]};return t.eachFeature(function(t,r){let o={};e.forEach(function(e){o[e]=t.feature.properties[e],i.aggr[e]||(i.aggr[e]={}),o[e]&&"number"==typeof o[e]&&((!i.aggr[e].max||i.aggr[e].max<o[e])&&(i.aggr[e].max=o[e]),(!i.aggr[e].min||i.aggr[e].min>o[e])&&(i.aggr[e].min=o[e]))}),i.data.push(o)}),i}}window.siteMap=new class extends window.L.Evented{constructor(){super(),this.selected=!1;const t=this.map=L.map("map",{zoomControl:!1}).setView([45,-89.623861],6);this.el=document.querySelector("#map"),new L.Control.Zoom({position:"topright"}).addTo(t);const i=L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',label:"OpenStreetMap Humanitarian"}).addTo(t),r=(L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',label:"OpenStreetMap Mapnik"}),L.esri.basemapLayer("Imagery",{label:"Esri Satellite"}));L.esri.basemapLayer("Topographic",{label:"Esri Topographic"});var o=[i,r];t.addControl(L.control.basemaps({basemaps:o,tileX:0,tileY:0,tileZ:1})),this.springs=L.esri.featureLayer({url:"https://data.wgnhs.wisc.edu/arcgis/rest/services/springs/springs_inventory/MapServer/1",pointToLayer:function(t,i){return new e(i,{weight:2,radius:4,color:"#3388ff"})}}).once("load",function(){this.fire("init")}.bind(this)).on("click",function(t){this._highlight!==t.propagatedFrom?this.fire("interaction",t.propagatedFrom.feature.properties):this.fire("interaction")}.bind(this)).addTo(t),this._highlight=null,this.springPhotos=L.esri.featureLayer({url:"https://data.wgnhs.wisc.edu/arcgis/rest/services/springs/springs_inventory/MapServer/6"}),this.springSketches=L.esri.featureLayer({url:"https://data.wgnhs.wisc.edu/arcgis/rest/services/springs/springs_inventory/MapServer/4"})}getPoint(t){let e;return this.springs.eachFeature(function(i){i.feature.properties.Site_Code===t&&(e=i)}),e}zoomToPoint(t){let e=this.getPoint(t);e&&this.map.setZoomAround(e.getLatLng(),15)}getHighlightPoint(){return this._highlight}setHighlightPoint(t){t?(this._highlight=t,this._highlight.bringToFront(),this._highlight.highlight()):this.clearSelection()}selectPoint(t){let e=this.getPoint(t);return e!==this.getHighlightPoint()&&(this.clearSelection(),this.setHighlightPoint(e)),e.feature.properties}clearSelection(){this._highlight&&(this._highlight.bringToBack(),this._highlight.removeHighlight()),this._highlight=null}setVisibility(t){t?(this.el.removeAttribute("data-closed"),this.map.invalidateSize()):this.el.setAttribute("data-closed",!0)}},window.sidebar=document.querySelector("#sidebar"),window.siteMap.once("init",function(){window.siteData=new i(window.siteMap.springs,window.siteMap.springPhotos,window.siteMap.springSketches),window.aggrData=siteData.aggrData;var t=function(){document.dispatchEvent(new CustomEvent("toggle-sketch",{bubbles:!0,detail:{closed:!0}})),document.querySelectorAll("site-details").forEach(function(t){t.siteinfo=null,t.photos=null}),document.querySelectorAll("site-sketch").forEach(function(t){t.pdfsrc=null})},e=function(e){return t(),Promise.all([window.siteData.lookupPhotos(e.Site_Code).catch(()=>[]),window.siteData.lookupSketches(e.Site_Code).catch(()=>[])]).then(function(t){document.querySelectorAll("site-details").forEach(function(i){i.siteinfo=e,i.photos=t[0]}),t[1]&&document.querySelectorAll("site-sketch").forEach(function(e){e.pdfsrc=t[1][0]})})};window.router=new class extends window.L.Evented{constructor(){super();let t=this.router=new Navigo(window.location.origin+"/springs-data/");Object.entries(this.route).forEach(function(e){e[1].signature?t.on(e[1].signature,e[1].handler):t.notFound(e[1].handler)})}resolve(){this.router.resolve()}get route(){return{entry:{handler:this._entryRoute.bind(this)},view:{signature:"/view/:Site_Code",handler:this._viewSite.bind(this)},print:{signature:"/print/:Site_Code",handler:this._printSite.bind(this)}}}_updateLocation(t){this.router.pause(),this.router.navigate(t),this.router.resume()}_entryRoute(){this._updateLocation("/"),this.fire("route-entry")}_viewSite(t){t.Site_Code?(this._updateLocation("/view/"+t.Site_Code),this.fire("route-view",t)):console.error("bad viewSite call")}_printSite(t){t.Site_Code?(this._updateLocation("/print/"+t.Site_Code),this.fire("route-print",t)):console.error("bad printSite call")}clearRoute(){this.setRoute()}setRoute(t,e){arguments.length>0&&this.route[t]?this.route[t].handler(e):this._entryRoute()}},window.router.on("route-entry",()=>{window.siteMap.clearSelection(),t(),document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("default"),window.siteMap.setVisibility(!0)}),window.router.on("route-view",t=>{let i=window.siteMap.selectPoint(t.Site_Code);document.querySelectorAll("site-details").forEach(function(t){t.printLayout=!1}),e(i).then(()=>{document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!0)})}),window.router.on("route-print",t=>{let i=window.siteMap.selectPoint(t.Site_Code);document.querySelectorAll("site-details").forEach(function(t){t.printLayout=!0}),e(i).then(()=>{document.querySelector("#app").removeAttribute("data-view"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!1)})}),window.router.resolve(),window.siteMap.on("interaction",t=>{t.Site_Code?window.router.setRoute("view",t):window.router.clearRoute()})}),document.addEventListener("clear-selection",function(t){window.router.clearRoute()}),document.addEventListener("toggle-print",function(t){t.detail.on?window.router.setRoute("print",t.detail.params):window.router.setRoute("view",t.detail.params)}),document.addEventListener("toggle-sketch",function(t){window.siteMap.setVisibility(t.detail.closed)}),document.addEventListener("stylepoints",function(t){t.detail.type&&window.siteMap.map.fire(t.detail.type+"points")})});
//# sourceMappingURL=index.min.js.map
